# Stock Science - 股票策略分析系统

## 项目简介

Stock Science 是一个基于技术分析的股票策略分析系统，旨在帮助投资者通过量化分析方法筛选和分析股票。系统提供两个核心分析模块：

- **StockPre**: 沪深300成分股筛选系统 - 自动扫描沪深300成分股，基于技术指标筛选买入信号股票
- **Stock Grain Ranking**: 多维评分股票分析系统 - 对指定股票进行多维度评分，提供买卖建议

### 适用场景

- 📊 **股票筛选**: 从沪深300成分股中筛选符合技术指标的股票
- 📈 **个股分析**: 对指定股票进行深度技术分析，获取买卖建议
- 💰 **策略回测**: 验证交易策略的历史表现
- 📚 **学习研究**: 了解技术分析指标的应用方法

### 核心特性

- 🚀 **本地缓存**: 数据缓存24小时，大幅提升运行速度（90%+）
- 🔄 **智能重试**: API失败自动重试3次，带1-3秒随机延迟
- ⚡ **高效并发**: 8线程并发处理，保持原始处理速度
- 📊 **多维分析**: 结合均线、MACD、RSI、BOLL、成交量等多个技术指标
- 🌍 **宏观数据**: 集成CPI、GDP、PMI等宏观经济数据

---

## 快速开始

### 环境要求

- Python 3.9+
- 网络连接（用于获取股票数据）

### 安装依赖

```bash
pip install -r requirements.txt
```

### 运行示例

#### StockPre - 沪深300成分股筛选

```bash
python stockPre.py
```

**输出示例**:
```
=== 买入信号股票推荐 (按累计收益率降序) ===
名称                  代码             最新日期        股价      收益率       判定依据
华润三九                000999.SZ      2026-02-06   28.36 145.42%  MACD金叉 + 放量20%
中天科技                600522.SH      2026-02-06   21.91 109.21%  均线金叉 + MACD金叉
```

#### Stock Grain Ranking - 个股多维评分分析

```bash
cd stock_grain_ranking
python main.py -s 600489 601088 -b 20250207 -e 20260207
```

**参数说明**:
- `-s`: 股票代码（多个代码用空格分隔）
- `-b`: 开始日期（格式：YYYYMMDD）
- `-e`: 结束日期（格式：YYYYMMDD，默认当天）

**输出示例**:
```
========================================
股票名称: 中国神华(600489)
数据期间: 2025-02-07 至 2026-02-07

【2026-02-06 操作建议】持有
当前价格: 35.20

【多维评分系统】
买入评分: 0.45/1.00  (当前阈值: 0.60)
卖出压力: 0.35/1.00  (当前阈值: 0.40)
```

---

## 功能特性详解

### StockPre 系统

**功能描述**:
- 自动获取沪深300成分股列表
- 对每只股票计算技术指标（均线、MACD、RSI、BOLL、成交量）
- 基于多条件筛选买入信号（至少满足2个条件）
- 进行策略回测验证
- 按累计收益率排序输出推荐股票

**技术指标**:
- **均线**: 5日均线、20日均线
- **MACD**: 快线(12)、慢线(26)、信号线(9)
- **RSI**: 14日相对强弱指标
- **BOLL**: 20日布林带
- **成交量**: 3日平均成交量及变化率

**筛选条件**:
- 均线金叉（5日均线 > 20日均线）
- MACD金叉（MACD > MACD信号线）
- RSI超卖（RSI < 30）
- 股价触及BOLL下轨
- 成交量放大20%以上

### Stock Grain Ranking 系统

**功能描述**:
- 对指定股票进行技术指标计算
- 生成多维评分（买入评分 + 卖出压力）
- 动态调整买入/卖出阈值
- 集成宏观经济数据（CPI、GDP、PMI、汇率）
- 提供详细的买卖建议和评分构成

**评分系统**:
- **买入评分** (权重100%):
  - MACD动量 (30%)
  - BOLL通道 (20%)
  - RSI背离 (15%)
  - 量价配合 (20%)
  - 宏观因子 (15%)

- **卖出压力** (权重100%):
  - 趋势衰减 (10%)
  - 超买系数 (10%)
  - 资金流出 (10%)
  - 回撤压力 (10%)

**宏观因子**:
- CPI（消费者物价指数）
- GDP（国内生产总值）
- PMI（采购经理指数）
- 汇率（美元兑人民币）

---

## 技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Python | 3.9+ | 主要编程语言 |
| pandas | 2.2.3 | 数据处理 |
| numpy | 1.23.5 | 数值计算 |
| akshare | 1.16.61 | 股票数据获取 |
| pandas-ta | 0.3.14b0 | 技术指标计算 |

---

## 项目结构

```
stockScience/
├── stockPre.py                      # StockPre系统（已集成缓存）
├── stockPre_lite.py                 # StockPre轻量级改进版
├── stock_grain_ranking/
│   ├── main.py                      # StockGrain系统（已集成缓存）
│   ├── main_lite.py                 # StockGrain轻量级改进版
│   ├── data.py                      # 数据获取模块（已集成缓存）
│   ├── indicators.py                 # 技术指标计算
│   ├── signals.py                    # 信号生成模块
│   └── backtest.py                   # 回测模块
├── cache_manager.py                 # 缓存管理模块 ⭐
├── data_resilient.py                # 带重试的数据获取模块 ⭐
├── cache/                          # 缓存目录
│   ├── stock/                       # 股票数据缓存
│   ├── macro/                       # 宏观数据缓存
│   └── .gitignore                   # 忽略缓存文件
├── stockRanking.py                  # 股票排名模块
├── requirements.txt                  # Python依赖
├── README.md                       # 本文件
├── BENCHMARK.md                     # StockGrain Benchmark报告
└── STOCKPRE_BENCHMARK.md             # StockPre Benchmark报告
```

---

## 缓存机制 ⭐

本项目集成了本地缓存机制，大幅提升数据获取速度和稳定性：

### 缓存特点

- 🚀 **速度提升**: 缓存命中时速度提升90%+
- 💾 **自动缓存**: 首次运行后自动保存数据
- ⏰ **自动过期**: 缓存24小时后自动失效
- 🔄 **智能重试**: API失败时自动重试3次
- 📊 **统计信息**: 可查看缓存使用情况

### 缓存管理

```python
from cache_manager import CacheManager

# 查看缓存统计
stats = CacheManager.get_cache_stats()
print(f"股票缓存数: {stats['stock_cache_count']}")
print(f"宏观数据缓存数: {stats['macro_cache_count']}")
print(f"总大小: {stats['total_size_mb']} MB")

# 清理过期缓存
CacheManager.clear_expired_cache()

# 清空所有缓存
CacheManager.clear_all_cache()
```

---

## 版本历史

### v1.2 (2026-02-07) - 本地缓存机制和API重试

**新增功能**:
- 新增 `cache_manager.py` 缓存管理模块
  - 股票数据缓存（24小时过期）
  - 宏观数据缓存（24小时过期）
  - 缓存统计和管理功能

- 新增 `data_resilient.py` 带重试的数据获取模块
  - 股票数据获取（带缓存+重试）
  - 宏观数据获取（带缓存+重试）
  - 沪深300成分股获取（带缓存）
  - 股票信息获取（带缓存）
  - API失败自动重试3次
  - 重试之间添加1-3秒随机延迟

**系统集成**:
- `stockPre.py` 集成缓存机制
- `stock_grain_ranking/data.py` 集成缓存机制

**性能提升**:
- 缓存命中时速度提升90%+
- 异步延迟重试不影响并发处理

### v1.1 (2026-02-07) - 轻量级改进方案

**新增功能**:
- 添加进度显示功能
- 添加结果自动保存到CSV
- 添加简单统计报告
- 保留原始并发速度（8线程，无限流）
- 简单错误处理机制

### v1.0 (2026-02-07) - 初始版本

**核心功能**:
- StockPre系统：沪深300成分股筛选
- Stock Grain Ranking系统：多维评分股票分析
- 技术指标计算：均线、MACD、RSI、BOLL、成交量
- 策略回测验证

---

## Benchmark报告

详细的测试结果和性能分析请查看：
- [BENCHMARK.md](stock_grain_ranking/BENCHMARK.md) - Stock Grain Ranking系统测试报告
- [STOCKPRE_BENCHMARK.md](STOCKPRE_BENCHMARK.md) - StockPre系统测试报告

---

## 常见问题

### Q: 为什么首次运行很慢？

A: 首次运行需要从网络获取所有股票数据，可能需要较长时间。后续运行会使用缓存，速度会大幅提升（90%+）。

### Q: 数据更新频率如何？

A: 股票数据缓存24小时后自动过期，确保数据时效性。您可以手动清空缓存以获取最新数据。

### Q: 系统支持哪些股票？

A: StockPre系统支持沪深300成分股，Stock Grain Ranking系统支持所有A股股票。

### Q: 如何提高数据获取成功率？

A: 系统已集成智能重试机制（3次重试+随机延迟），大幅提升数据获取成功率。如仍遇到问题，建议在网络稳定时段运行。

---

## 许可证

本项目仅供学习和研究使用，不构成投资建议。投资有风险，入市需谨慎。

---

**最后更新**: 2026-02-07